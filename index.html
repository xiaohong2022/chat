<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="shortcut icon" href="https://xiaohong2022.github.io/static/img/avatar.png">
<title>小宏の聊天室</title>
<style>
    div#app {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #bbb;
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: center;
        flex-wrap: nowrap;
        align-content: center;
    }

    .app-content {
        background: #fff;
        border-radius: 20px;
        min-width: 80%;
        max-width: 80%;
        max-height: 70%;
        min-height: 70%;
        box-shadow: 0px 10px 30px 0px #888;
        width: 80%;
        height: 70%;
    }

    .app-content-title {
        padding: 20px;
        text-align: center;
        background: #47c2ff;
        border-radius: 20px 20px 0px 0px;
        font-size: 20px;
        color: #fff;
        user-select: none;
    }

    .app-content-body {
        display: flex;
        flex-direction: row;
        width: 100%;
        height: calc(100% - 66px - 51px);
    }

    .app-content-body-left {
        width: 100px;
        height: 100%;
        border-right: solid 1px #bbb;
    }

    .app-content-body-right {
        width: calc(100% - 100px);
        height: 100%;
        overflow: auto;
    }

    .app-content-input {
        padding: 10px 15px;
        border-top: solid 1px #bbb;
        display: flex;
        flex-direction: row;
        align-items: center;
    }

    input {
        border: none;
        padding: 2px 3px;
        outline: none;
        width: calc(100% - 65px);
    }

    input:disabled {
        background-color: #fff;
        cursor: no-drop;
    }

    .app-content-body-left {
        display: flex;
        flex-direction: column;
        text-align: center;
    }

    .app-content-body-left-div {
        text-align: center;
        padding: 10px 0px;
        white-space: nowrap;
        text-overflow: ellipsis;
        width: 100%;
        overflow: hidden;
    }

    button {
        border: none;
        background: #0af;
        font-size: 15px;
        color: #fff;
        padding: 5px 10px;
        cursor: pointer;
        border-radius: 10px;
        transition: .3s;
    }

    button:hover {
        background: #009ae7;
    }

    button:active {
        transform: scale(.9);
    }

    button:disabled {
        opacity: .5;
        cursor: no-drop;
    }

    button:disabled:hover {
        background: #0af;
    }

    button:disabled:active {
        transform: scale(1);
    }

    .app-content-body-right-div {
        margin-left: 10px;
        margin-top: 5px;
        margin-bottom: 5px;
    }

    .app-content-body-right-div .app-content-body-right-div-bottom::selection {
        background: #38a3ff;
        color: #fff
    }

    .app-content-body-right-div-top {
        font-size: 14px;
        color: #888;
        margin-left: 2px;
        user-select: none;
    }

    .app-content-body-right-div-bottom {
        font-size: 16px;
        width: fit-content;
        background: #eee;
        padding: 5px 10px;
        border-radius: 5px;
    }

    .app-content-body-right-div.right {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        margin-right: 15px;
    }

    .app-content-body-right-div.right .app-content-body-right-div-bottom::selection {
        background: #fff;
        color: #38a3ff
    }

    .app-content-body-right-div.right .app-content-body-right-div-bottom {
        background: #38a3ff;
        color: #fff;
    }

    .app-content-body-right-xt {
        width: 100%;
        text-align: center;
        font-size: 15px;
        color: #aaa;
        margin-top: 10px;
        margin-bottom: 10px;
    }

    .app-content-body-right-xt::selection {
        background: #aaa;
        color: #fff
    }

    .copyright {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        height: fit-content;
        display: flex;
        justify-content: center;
        padding: 20px 0px;
        color: #555;
        user-select: none;
    }

    .app-content-body-left-top {
        display: flex;
        flex-direction: column;
        text-align: center;
        width: calc(100% - 8px * 2);
        height: calc(100% - 74px);
        overflow-y: scroll;
        padding: 0px 8px;
    }

    .app-content-body-left-top::-webkit-scrollbar {
        display: none;
    }

    .app-content-body-left-bottom {
        display: flex;
        flex-direction: column;
        width: 100%;
        height: fit-content;
    }

    .app-content-body-left-bottom-setname {
        text-align: center;
        padding: 10px 0px;
        border-top: solid 1px #bbb;
        font-size: 12px;
        cursor: pointer;
        user-select: none;
    }

    .app-content-body-left-bottom-clearmsg {
        text-align: center;
        padding: 10px 0px;
        border-top: solid 1px #bbb;
        font-size: 12px;
        cursor: pointer;
        user-select: none;
    }

    @media (max-width: 700px) {
        .app-content {
            background: #fff;
            border-radius: 0px;
            min-width: 100%;
            max-width: 100%;
            max-height: 100%;
            min-height: 100%;
            box-shadow: none;
            width: 100%;
            height: 100%;
        }

        .app-content-title {
            border-radius: 0px;
        }

        .copyright {
            bottom: 50px;
            font-size: 12px;
        }
    }
</style>
<div id="app">
    <div class="app-content">
        <div class="app-content-title">小宏の聊天室（<r>0</r> / 20）</div>
        <div class="app-content-body">
            <div class="app-content-body-left">
                <div class="app-content-body-left-top"></div>
                <div class="app-content-body-left-bottom">
                    <div class="app-content-body-left-bottom-setname">更改名字</div>
                    <div class="app-content-body-left-bottom-clearmsg">清空聊天记录</div>
                </div>
            </div>
            <div class="app-content-body-right"></div>
        </div>
        <div class="app-content-input">
            <input placeholder="说点啥好呢？">
            <button>发送！</button>
        </div>
    </div>
    <div class="copyright">Copyright (c) 2023 xiaohong2022</div>
</div>
<script>
    !function () {
        var $jscomp = $jscomp || {}; $jscomp.scope = {}; $jscomp.createTemplateTagFirstArg = function (b) { return b.raw = b }; $jscomp.createTemplateTagFirstArgWithRaw = function (b, c) { b.raw = c; return b }; $jscomp.arrayIteratorImpl = function (b) { var c = 0; return function () { return c < b.length ? { done: !1, value: b[c++] } : { done: !0 } } }; $jscomp.arrayIterator = function (b) { return { next: $jscomp.arrayIteratorImpl(b) } }; $jscomp.makeIterator = function (b) { var c = "undefined" != typeof Symbol && Symbol.iterator && b[Symbol.iterator]; return c ? c.call(b) : $jscomp.arrayIterator(b) };
        !function (b, c) { "object" == typeof exports && "undefined" != typeof module ? module.exports = c() : "function" == typeof define && define.amd ? define(c) : (b = "undefined" != typeof globalThis ? globalThis : b || self).xhdialog = c() }(this, function () {
            var b = function (a, e) {
                var d = this, f = document.createElement("button"); f.className = "xhdialog-options-btn" + (a.class ? " " + ("string" == typeof a.class ? a.class : "object" == typeof a.class ? Object.values(a.class).join(" ") : "") : ""); f.addEventListener("click", a.onClick ? a.onClick : null); f.addEventListener("click",
                    function () { d.options.closeOnClick && d.$offsetDialog._root.close(d._selectValue) }); f.innerHTML = '<div class="xhdialog-options-btn-loading xhdialog-options-btn-loading-close"></div><span></span>'; this.$element = f; this.$offsetDialog = e; this.$element.querySelector("span").innerText = a.text; this._state = "enable"; this._loading = !1; this.options = { closeOnClick: !!a.closeOnClick }; this._selectValue = a.value
            }; b.prototype.startload = function () {
                this.$element.querySelector(".xhdialog-options-btn-loading").classList.remove("xhdialog-options-btn-loading-close");
                this._loading = !0; return this
            }; b.prototype.stopload = function () { this.$element.querySelector(".xhdialog-options-btn-loading").classList.add("xhdialog-options-btn-loading-close"); this._loading = !1; return this }; b.prototype.remove = function () { this.$element.remove() }; b.prototype.setText = function (a) { this.$element.querySelector("span").innerText = a; return this }; b.prototype.getText = function () { return this.$element.querySelector("span").innerHTML }; b.prototype.disabled = function (a) {
                this._state = (this.$element.disabled =
                    void 0 === a ? !0 : a) ? "disabled" : "enable"; return this
            }; b.prototype.enable = function (a) { a = void 0 === a ? !0 : a; this.$element.disabled = !a; this._state = a ? "enable" : "disabled"; return this }; var c = function (a) {
                var e = this, d = document.createElement("div"); d.className = "xhdialog" + (a.class ? " " + ("string" == typeof a.class ? a.class : "object" == typeof a.class ? Object.values(a.class).join(" ") : "") : ""); this.$element = d; var f = document.createElement("div"); f.className = "xhdialog-overlay"; this.$overlay = f; var g = a.title ? '<div class="xhdialog-title">' +
                    a.title + "</div>" : ""; g += '<div class="xhdialog-content">' + (a.content ? a.content : "") + "</div>"; d.innerHTML = g; if (a.buttons) { g = document.createElement("div"); g.className = "xhdialog-options"; for (var l = a.buttons.map(function (n) { return new b(n, d) }), m = $jscomp.makeIterator(l), h = m.next(); !h.done; h = m.next())h = h.value, g.appendChild(h.$element), h.$element._root = h; d.appendChild(g); this.buttons = { $card: g, $elements: l } } this._state = "close"; f.addEventListener("click", function () { e.options.overlayOnClose && e.close(e._overlayValue) });
                document.body.appendChild(d); this._select = null; this._overlayValue = a.overlayValue; d._root = this; this.options = { removeOnClose: !!a.removeOnClose, overlayOnClose: a.overlayOnClose || !0 }
            }; c.prototype.open = function () {
                var a = this; document.body.appendChild(this.$overlay); this.$element.classList.add("xhdialog-animation-open"); this.$overlay.classList.add("xhdialog-overlay-animation-open"); document.body.classList.add("xhdialog-body-lock"); setTimeout(function () {
                    a.$element.classList.add("xhdialog-open"); a.$overlay.classList.add("xhdialog-overlay-show");
                    a.$element.classList.remove("xhdialog-animation-open"); a.$overlay.classList.remove("xhdialog-overlay-animation-open")
                }, 10); this._state = "open"; return this
            }; c.prototype.close = function (a) {
                var e = this; this.$element.classList.add("xhdialog-animation-close"); this.$overlay.classList.add("xhdialog-overlay-animation-close"); 1 == document.querySelectorAll(".xhdialog").length && document.body.classList.remove("xhdialog-body-lock"); setTimeout(function () {
                    e.$element.classList.remove("xhdialog-open"); e.$overlay.classList.remove("xhdialog-overlay-show");
                    e.$element.classList.remove("xhdialog-animation-close"); e.$overlay.classList.remove("xhdialog-overlay-animation-close"); e.options.removeOnClose ? e.remove() : document.body.removeChild(e.$overlay)
                }, 300); this._select = a; this._state = "close"; return a
            }; c.prototype.remove = function () { this.$element.remove(); this.$overlay.remove() }; c.prototype.isOpen = function () { return "open" == this._state }; c.prototype.addElement = function (a) { this.$element.querySelector(".xhdialog-content").appendChild(a); return a }; var k = document.createElement("style");
            k.type = "text/css"; k.innerHTML = `.xhdialog{box-sizing:border-box;margin:0;padding:0;outline:0}body.xhdialog-body-lock{overflow:hidden}.xhdialog-overlay{position:fixed;top:0;left:0;z-index:50000;display:none;box-sizing:border-box;background:rgba(0,0,0,.4);opacity:0;-webkit-transition:.3s,width 0s,height 0s;transition:.3s,width 0s,height 0s}.xhdialog-overlay-show{display:block;width:100%;height:100%;opacity:1}.xhdialog-overlay-animation-open{display:block;opacity:0}.xhdialog-overlay-animation-close{opacity:0}
.xhdialog{position:fixed;top:0;right:0;bottom:0;left:0;z-index:999999999;display:none;overflow:hidden;margin:auto;padding:20px 30px 70px;max-width:70%;max-height:70%;min-width:300px;min-height:170px;-webkit-border-radius:10px;border-radius:10px;background:#fff;-webkit-box-shadow:0 11px 15px -7px rgb(0 0 0/20%),0 24px 38px 3px rgb(0 0 0/14%),0 9px 46px 8px rgb(0 0 0/12%);box-shadow:0 11px 15px -7px rgb(0 0 0/20%),0 24px 38px 3px rgb(0 0 0/14%),0 9px 46px 8px rgb(0 0 0/12%);-webkit-transition-duration:.3s;transition-duration:.3s;
-webkit-transform:scale(.7);transform:scale(.7)}.xhdialog.xhdialog-open{display:block;-webkit-transform:scale(1);transform:scale(1)}.xhdialog.xhdialog-animation-open{display:block;opacity:0}.xhdialog.xhdialog-animation-close{opacity:0;-webkit-transform:scale(.7);transform:scale(.7)}.xhdialog button.xhdialog-options-btn{margin-left:9px;padding:6px 13px;border:1px solid #aaa;border-radius:5px;background:0 0;color:#000;font-size:14px;cursor:pointer;-webkit-transition-duration:.3s;transition-duration:.3s;user-select:none!important;
-webkit-user-select:none!important;-moz-user-select:none!important;-ms-user-select:none!important}.xhdialog button.xhdialog-options-btn:hover{background:rgba(0,0,0,.07)}.xhdialog button.xhdialog-options-btn:active{background:rgba(0,0,0,.2);-webkit-transform:scale(.9);transform:scale(.9)}.xhdialog button.xhdialog-options-btn.xhdialog-options-btn-confirm{border:1px solid var(--color-primary);background:var(--color-primary);color:var(--color-button-text)}.xhdialog button.xhdialog-options-btn.xhdialog-options-btn-confirm:hover{
border:1px solid var(--color-primary-hover);background:var(--color-primary-hover)}.xhdialog button.xhdialog-options-btn.xhdialog-options-btn-confirm:active{border:1px solid var(--color-primary-press);background:var(--color-primary-press)}.xhdialog button.xhdialog-options-btn[disabled]{opacity:.4;cursor:auto;-webkit-transform:scale(1);transform:scale(1)}.xhdialog .xhdialog-options{position:fixed;right:30px;bottom:20px}.xhdialog .xhdialog-title{margin-bottom:10px;color:var(--title-color);font-size:27px;user-select:none;
-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none}.xhdialog .xhdialog-content{color:var(--content-color);white-space:pre-wrap;word-wrap:break-word;font-size:14px}.xhdialog-prompt-input{margin-top:5px;padding:5px 10px;width:100%;outline:0;border:1px solid #aaa;border-radius:5px;background:0 0;color:#000;font-size:14px;-webkit-transition-duration:.3s;transition-duration:.3s}.xhdialog-prompt-input:focus-visible{border:1px solid #0af}.xhdialog .xhdialog-content{display:flex;flex-direction:column;align-items:flex-start}
.xhdialog-alert,.xhdialog-confirm,.xhdialog-prompt{max-width:40%;max-height:30%}.xhdialog{--color-primary:#0af;--color-primary-hover:rgba(0,170,255,0.87);--color-primary-press:rgba(0,170,255,0.6);--color-button-text:#fff;--title-color:#000;--content-color:rgba(0,0,0,0.73)}`
            document.head.appendChild(k); return {
                alert: async function (a) { a = new c({ title: "系统", content: a, buttons: [{ text: "确认", value: void 0, closeOnClick: !0, class: "xhdialog-options-btn-confirm" }], class: ["xhdialog-alert"], removeOnClose: !0, overlayValue: void 0 }); await new Promise(requestAnimationFrame); a.open(); for (await new Promise(requestAnimationFrame); ;) { if (!a.isOpen()) { await new Promise(requestAnimationFrame); break } await new Promise(requestAnimationFrame) } }, confirm: async function (a) {
                    a = new c({
                        title: "系统", content: a, buttons: [{
                            text: "确认", value: !0,
                            closeOnClick: !0, class: "xhdialog-options-btn-confirm"
                        }, { text: "取消", value: !1, closeOnClick: !0 }], class: ["xhdialog-confirm"], removeOnClose: !0, overlayValue: !1
                    }); await new Promise(requestAnimationFrame); a.open(); for (await new Promise(requestAnimationFrame); ;) { if (!a.isOpen()) return await new Promise(requestAnimationFrame), a._select; await new Promise(requestAnimationFrame) }
                }, prompt: async function (a, e) {
                    a = new c({
                        title: "系统", content: a, buttons: [{ text: "确认", value: !0, closeOnClick: !0, class: "xhdialog-options-btn-confirm" }, {
                            text: "取消",
                            value: !1, closeOnClick: !0
                        }], class: ["xhdialog-prompt"], removeOnClose: !0, overlayValue: !1
                    }); var d = document.createElement("input"); d.className = "xhdialog-prompt-input"; d.value = e || ""; a.$element.querySelector(".xhdialog-content").appendChild(d); await new Promise(requestAnimationFrame); a.open(); for (await new Promise(requestAnimationFrame); ;) { if (!a.isOpen()) return await new Promise(requestAnimationFrame), a._select ? d.value : null; await new Promise(requestAnimationFrame) }
                }, Dialog: c
            }
        });
    }();
    !function () {
        /**@return {IDBFactory}*/
        function getIndexDB() {
            const i =
                window.indexedDB ||
                window.mozIndexedDB ||
                window.webkitIndexedDB ||
                window.msIndexedDB ||
                window.shimIndexedDB;
            if (i) {
                return i
            }
            return null
        }
        var indexeddb = getIndexDB();
        var dbsql = indexeddb.open("xhchat_db", 1);
        dbsql.onupgradeneeded = () => {
            const db = dbsql.result;
            const store = db.createObjectStore("messages", {
                keyPath: "id",
                autoIncrement: true,
            });
        };
        dbsql.onsuccess = () => {
            console.log("本地消息数据库连接已建立");
        };
        function cleardbmsg() {
            const db = dbsql.result
            const tx = db.transaction("messages", "readwrite")
            const todosStore = tx.objectStore("messages")
            todosStore.clear();
        };
        function _0x28b9c1(a) { var f = "", c = 0; for (a = a.replace(/[^A-Za-z0-9\+\/=]/g, ""); c < a.length;) { var g = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(c++)); var d = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(c++)); var b = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(c++)); var e = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(c++)); g = g << 2 | d >> 4; d = (d & 15) << 4 | b >> 2; var k = (b & 3) << 6 | e; f += String.fromCharCode(g); 64 != b && (f += String.fromCharCode(d)); 64 != e && (f += String.fromCharCode(k)) } a = f; f = ""; for (b = 0; b < a.length;)e = a.charCodeAt(b), 128 > e ? (f += String.fromCharCode(e), b++) : 191 < e && 224 > e ? (c = a.charCodeAt(b + 1), f += String.fromCharCode((e & 31) << 6 | c & 63), b += 2) : (c = a.charCodeAt(b + 1), g = a.charCodeAt(b + 2), f += String.fromCharCode((e & 15) << 12 | (c & 63) << 6 | g & 63), b += 3); return f }
        var _0x5d01 = _0x28b9c1("MTI5OTk0OU9UTldVUCA0Nzc5MDhyVmpycHMgODl0QXhYZU0gMFBDOXZUTk5XMiAxMDk2NjE3c21XWEZYIDV2TE1rUFIgaW5jbHVkZXMgMTI0NDJLblBZbHogZ2V0SXRlbSAxMUtKeVZQaSAyMzU2NjF5Y1haQ1UgMzU2NzFsV1ZvbGUgc3czQUJrTkM1Qm40YWgzb25HNmkgODk2MTk3akVCdWxX").split(" ");
        (function (_0x23b3c1, _0x28d863) { function _0x434218(_0x5b21f1, _0x10911f) { return _0x2f09(_0x10911f - 0x226, _0x5b21f1); } while (!![]) { try { var _0x4abb34 = -parseInt(_0x434218(0x29c, 0x29c)) + parseInt(_0x434218(0x299, 0x29b)) + parseInt(_0x434218(0x29b, 0x2a0)) + parseInt(_0x434218(0x290, 0x295)) * parseInt(_0x434218(0x29b, 0x29e)) + -parseInt(_0x434218(0x29b, 0x299)) * parseInt(_0x434218(0x295, 0x297)) + parseInt(_0x434218(0x2a4, 0x29d)) + parseInt(_0x434218(0x294, 0x298)) * -parseInt(_0x434218(0x2a7, 0x2a1)); if (_0x4abb34 === _0x28d863) { break; } else { _0x23b3c1['push'](_0x23b3c1['shift']()); } } catch (_0x1368be) { _0x23b3c1['push'](_0x23b3c1['shift']()); } } }(_0x5d01, 0xacb61)); function _0x5fdd4e(_0x5e6980, _0x2e8cdd) { return _0x2f09(_0x5e6980 - 0x150, _0x2e8cdd); } function _0x2f09(_0x1468b7, _0x53f62a) { _0x2f09 = function (_0x5d01f9, _0x2f09de) { _0x5d01f9 = _0x5d01f9 - 0x6e; var _0x14a610 = _0x5d01[_0x5d01f9]; return _0x14a610; }; return _0x2f09(_0x1468b7, _0x53f62a); }
        var dirty = _0x28b9c1("6IiU5ZCuIOaKl+iuriDmiZPmrbsg5Y+Y5oCBIOm6u+eXuSDmjqXlkLsg5rWB6KGAIOS+rui+sSDljrvmrbsg6IiU552AIOaMieaRqSDni5flj6sg6KOk6KGpIOWtrOenjSDliLrmv4Ag6Z2S5aSp55m95pelIOaLlOWHuuadpSDlkbvlkJ8g5bCP5L6/IOeJm+avlCDml6DogLsg5oOz5q27IOWHuuihgCDoo7jpnLIg5om+5q27IOeMjuaeqiDni4LlkKAg5Y+M562SIOWPkeaEoyDmrbvliJEg5ZKM54uXIOiAgeavjeeMqiDlsI/lp5Ag6IiU5ZC7IOW/q+aEnyDniLHmipog5oOF5L6jIOiDveWEvyDljb/ljb/miJHmiJEg5o+S6L+bIOa1keWchiDnmoTpgLwg5aiH5ZaYIOaVmeW+kiDljZXouqsg57qm5LyaIOeOm+WPvCDnpZblrpcg5YW05aWL5YmCIOa3q+WogSDkuqTphY0g5Y+R5oOFIOeqneWbiuW6nyDmjonkvaAg5Yu+5pCtIOilv+iXjyDkuLvmnYMg5oqT6IO4IOWVpuaymSDlqJjnmoQg5oqa5pG4IOWkqeiRrCDlpKvlkJsg5aSr5aa7IOe+nui+sSDljprohLjnmq4g6LCp6aqCIOWCu+eTnCDlhb3mgKcg56S65aiBIOihqOeZvSDoiJTliqjnnYAg55Wc55SfIOmTheW8uSDmgYvniLEg5bCE5q27IOiwg+aVmSDmmK/ni5cg5YeM6L6xIOi9ruaJiyDmu6Hni5cg5Y675LiWIOavkuibh+mSuyDlhajlrrYg56m06YeMIOW3tOWYjiDkuI3nqb8g5byT5bypIOWFvOiBjCDkuIrku5Yg5a+56LGhIOavkuaerSDpurvphonmnqog5rGh55qEIOe7j+aWhyDms5Xova4g5ZW15ZW1IOWkluWtmSDol4/msJEg5Y2R6YSZIOaKpOazlSDnuqDnurcg5rGJ5Lq6IOWbveawkeWFmiDmrbvkvaAg5Lqy5LiA5Y+jIOWNh+WkqSDmnInnl4Ug5pS+5bGBIOWwvOeOmyDnlq/ni5cg5a+G5a6XIOaequaJiyDoh6rmnYAg6ZOD5aOwIOegjeatuyDnmb3lq6kg6aqaIOWmiOeahCBtZCBNRCBTQiBzYiBTYiBzQiDlgrvpgLwg5YK75a2QIOWCu+ibiyDohJHmrosg5Y2n5qe9IOaIkeaTjSDmiJHojYkg54mb6YC8IHdjIG1EIE1kIOeMm+WQuCDlk6Xlk6Ug5by65pq0IOiEseWFiSDkurrmuKMg5pel5L2gIOazleS8miDlhL/lrZAg5oCn54ixIOi1sOeLlyDniZvnsqog57Kq5L6/IOWxjiDmnqrmr5kg57uR5p62IOa0u+WSjCDmnYLnp40g5LqG5LuWIOWltua7tCDnrKjom4sg5rOV5q2jIOWPl+WtlSDmg4Xkurog6YSZ6KeGIOa1geawkyDnmb3nl7Qg5LiR5YWr5oCqIOa7muW8gCDlvLHmmbog5a2k5YS/IOaXoOacn+W+kuWIkSDku5blpoggVE0gdG0gVG0gdE0g6LiP6amsIOKEoiDmrLLngasg57qi6Imy5oGQ5oCWIOW5suatuyDohZDotKUg5omT6ZKIIOmprOWPvCDoibLoibIg5oiQ5Lq656S+IOWQjOWxhSDnpr3lhb0g5bm85aWz").split(" ")
        function it(name, room_id) {
            if (!name) location.reload();
            var renlist = [];
            var wwwwww = 0;
            var wwwwwwww = 0;
            var sleeplenmgth = 0;
            if (localStorage.getItem("xhchat_isreadannouncement") !== "2") {
                localStorage.setItem("xhchat_isreadannouncement", "2")
                var x = new xhdialog.Dialog(
                    {
                        title: "近期更新：v1.2.0",
                        content:
                            "1. 添加防刷屏机制（每发5条消息需休息5sec）\n2. 修复用户列表问题\n3. 如果名字与作者有关的，将会自动改名\n4. 名字内部不能含脏话\n5. 修复“当有一个玩家重名的时候所有玩家都会退出”的bug\n\n预计上线：表情包、图片"
                        , buttons: [{ text: "确认", value: !0, closeOnClick: !0, class: "xhdialog-options-btn-confirm" }]
                    });
                x.open();
            }
            function updataman() {
                document.querySelector("r").innerText = renlist.length;
                document.querySelector(".app-content-body-left-top").innerHTML = renlist.map(v => `<div class="app-content-body-left-div" title="${v}">${v}</div>`).join("")
            }
            function sleepsend() {
                document.querySelector("input").disabled = true;
                document.querySelector("button").disabled = true;
                var x = Number(sleeplenmgth);
                document.querySelector("input").placeholder = `请 静息 ${x}秒 后再来吧~`
                var y = setInterval(() => {
                    x--;
                    document.querySelector("input").placeholder = `请 静息 ${x}秒 后再来吧~`
                    if (x === 0) {
                        clearInterval(y)
                        document.querySelector("input").disabled = false;
                        document.querySelector("button").disabled = false;
                        document.querySelector("input").placeholder = `静息结束！可以继续发消息~`
                        setTimeout(() => {
                            document.querySelector("input").placeholder = `说点啥好呢？`
                        }, 1000)
                    }
                }, 1000);
            }
            function ask() {
                if (wwwwwwww === 0) {
                    wwwwwwww = 1;
                }
            }
            function dbToMessage() {
                const db = dbsql.result
                const tx = db.transaction("messages", "readwrite")
                const todosStore = tx.objectStore("messages")
                const query = todosStore.getAll()
                query.onsuccess = () => {
                    console.log("消息数据库", query.result);
                    query.result.map(v => JSON.parse(v.text)).forEach(v => {
                        if (v.type === 0) {
                            addSystemMsg(v.data);
                        } else {
                            if (v.data.side === 1) {
                                addmsg(name, v.data.data)
                            } else {
                                addmsg(v.data.name, v.data.data)
                            }
                        }
                    })
                }
            }
            function addMessageToDB(data) {
                const db = dbsql.result
                const tx = db.transaction("messages", "readwrite")
                const todosStore = tx.objectStore("messages")
                const text = JSON.stringify(data)
                todosStore.put({ text });
            }
            function addmsg(n, s) {
                var r = document.createElement("div");
                r.className = "app-content-body-right-div"
                var r1 = document.createElement("div");
                r1.className = "app-content-body-right-div-top"
                var r2 = document.createElement("div");
                r2.className = "app-content-body-right-div-bottom"
                r1.innerText = n;
                r2.innerText = s;
                r.append(r1, r2);
                r.className += ` ${n === name ? "right" : "left"}`
                document.querySelector(".app-content-body-right").appendChild(r);
                var ws = document.querySelector(".app-content-body-right")
                ws.scrollTop = ws.scrollHeight;
            }
            function addSystemMsg(s) {
                var r = document.createElement("div");
                r.className = "app-content-body-right-xt"
                r.innerText = s;
                document.querySelector(".app-content-body-right").appendChild(r);
                var ws = document.querySelector(".app-content-body-right")
                ws.scrollTop = ws.scrollHeight;
            };
            var webs = new WebSocket("wss://socket-cr.codemao.cn:9090/coconut/?x-coconut-authorization=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ3b3JrX2lkIjoiMTc5MjE4MDQ1IiwidXNlcl9pZCI6IjkyMzIxNTEifQ.PEJx3asH_HECfXzs0VmjNUGif2tDSKbBvznCP_iGHmc&X-CodeMao-Mobile-Requested=%7B%22group_id%22%3A%22b494b662-67e9-4b54-a86b-82ac09ef9284%22%2C%22platform%22%3A%22web%22%2C%22origin%22%3A%22coconut%22%7D&EIO=3&transport=websocket");
            webs.onclose = function () {
                console.log("服务器中断！")
                document.querySelector("#app").style.display = "none";
                xhdialog.alert("服务器中断！即将重新加载！").then(() => { location.reload() })
            };
            function sendMessage(e) {
                if (e.length > 30) {
                    addSystemMsg("消息太长啦")
                    return
                }
                var x = 0;
                for (let i of String(e)) {
                    if ((i === " " || i === "　" || i === "\t") === false) {
                        x = 1;
                        break
                    }
                }
                if (x !== 1) {
                    addSystemMsg("消息不能为空哦")
                    return
                };
                wwwwww++;
                if (wwwwww > 5) {
                    wwwwww = 0;
                    sleeplenmgth += 5;
                    sleepsend();
                }
                if (new RegExp(dirty.join("|")).test(String(e))) {
                    addSystemMsg(">:(")
                }
                webs.send(`42["broadcast",${JSON.stringify({
                    data: String(e).replace(new RegExp(dirty.join("|"), "g"), function (v) { iss = 1; return "*".repeat(v.length) }),
                    room_id: room_id,
                    username: name
                })}]`);
            }
            function joinMan(r) {
                webs.send(`42["join",${JSON.stringify({
                    room_name: "XH_zu8s1tQ0g1",
                    username: r,
                    room_id: room_id,
                    work_id: "179218045"
                })}]`)
            }
            function leave(r) {
                webs.send(`42["leave",${JSON.stringify({
                    room_name: "XH_zu8s1tQ0g1",
                    username: r,
                    room_id: room_id,
                    work_id: "179218045"
                })}]`)
            }
            function ping() {
                webs.send("2");
            }
            function init() {
                dbToMessage();
                document.querySelector(".app-content-input input").addEventListener("keypress", function (v) {
                    if (v.keyCode === 13 && this.value !== "") {
                        sendMessage(this.value);
                        this.value = "";
                    }
                });
                document.querySelector(".app-content-input button").addEventListener("click", function (v) {
                    if (document.querySelector(".app-content-input input").value !== "") {
                        sendMessage(document.querySelector(".app-content-input input").value);
                        document.querySelector(".app-content-input input").value = "";
                    } else {
                        xhdialog.alert("欸，这框里...啥也没有欸")
                    }
                });
                document.querySelector(".app-content-body-left-bottom-clearmsg").addEventListener("click", function () {
                    xhdialog.confirm("你真的要清空聊天记录吗？").then(v => {
                        if (v) {
                            cleardbmsg();
                            document.querySelector(".app-content-body-right").innerHTML = "";
                        }
                    })
                });
                document.querySelector(".app-content-body-left-bottom-setname").addEventListener("click", function () {
                    xhdialog.prompt("输入新名字（需要重进）").then(v => {
                        if (!v) return;
                        if (v.length > 15) {
                            xhdialog.alert("名字太长啦")
                            return
                        }
                        var x = 0;
                        for (let i of String(v)) {
                            if ((i === " " || i === "　" || i === "\t") === false) {
                                x = 1;
                                break
                            }
                        }
                        if (x !== 1) {
                            xhdialog.alert("名字不能为空哦")
                            return
                        }
                        localStorage.setItem("xhchat_username", String(v))
                        location.reload()
                    });
                });
                window.addEventListener("beforeunload", function () {
                    leave(name)
                })
            }
            function onmsg({ data }) {
                var d = data
                if (d.startsWith("0")) {
                    console.log(JSON.parse(d.slice(1)))
                    joinMan(name);
                    init();
                } else if (isNaN(Number(d)) === false) {
                    if (d === "3") {
                        console.log("服务器ping成功")
                    } else if (d === "1") {
                        console.log("服务器即将中断")
                    } else if (d === "40") {
                        console.log("服务器加入成功")
                    }
                } else if (d.startsWith("42")) {
                    var w = JSON.parse(d.slice(2));
                    console.log(w);
                    var d2 = w[1]
                    switch (w[0]) {
                        case "join":
                            addSystemMsg(`${d2.username} 进入了聊天室`)
                            addMessageToDB({
                                type: 0,
                                data: `${d2.username} 进入了聊天室`
                            });
                            if (d2.username != name) {
                                renlist.push(d2.username);
                            };
                            updataman()
                            break;
                        case "join_ack":
                            renlist = d2.username_list
                            if (wwwwwwww === 0) {
                                updataman()
                            }
                            ask()
                            break;
                        case "leave":
                            addSystemMsg(`${d2.username} 离开了聊天室`)
                            addMessageToDB({
                                type: 0,
                                data: `${d2.username} 离开了聊天室`
                            });
                            renlist.splice(renlist.indexOf(d2.username), 1);
                            updataman()
                            break;
                        case "broadcast":
                            addmsg(d2.username, d2.data)
                            addMessageToDB({
                                type: 1,
                                data: {
                                    data: d2.data,
                                    name: d2.username,
                                    side: d2.username === name ? 1 : 0
                                }
                            });
                            break;
                        case "error":
                            document.querySelector("#app").style.display = "none";
                            xhdialog.alert(d2.message).then(() => { location.reload() })
                            break;
                    }
                }
            }
            setInterval(() => {
                ping();
            }, 50000)
            webs.onmessage = onmsg;
        };
        function itroom(name) {
            var _0x35a7 = ['19180GYGpTa', 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ3b3JrX2lkIjoiMTc5MjE4MDQ1IiwidXNlcl9pZCI6IjkyMzIxNTEifQ.PEJx3asH_HECfXzs0VmjNUGif2tDSKbBvznCP_iGHmc', '177tkxsTb', 'status', '20105KtFwBl', 'GET', '34349SAKTxL', 'send', '1WNuPUw', '4973bpDavB', 'onreadystatechange', '{\x22group_id\x22:\x22b494b662-67e9-4b54-a86b-82ac09ef9284\x22,\x22platform\x22:\x22web\x22,\x22origin\x22:\x22coconut\x22}', 'x-codemao-mobile-requested', '198439BjBDUX', 'readyState', '127482YayARz', 'x-coconut-authorization', '15895tGhOLr', 'setRequestHeader', 'responseText', 'https://socket-cr.codemao.cn/coconut/room?work_id=179218045', 'open', '22iVwIRP']; (function (_0x510f80, _0x303d58) { function _0x1fa519(_0xa92ef6, _0x5ce500) { return _0x4c5d(_0xa92ef6 - 0x197, _0x5ce500); } while (!![]) { try { var _0x1f03c4 = parseInt(_0x1fa519(0x296, 0x28b)) + parseInt(_0x1fa519(0x29a, 0x2a0)) * parseInt(_0x1fa519(0x292, 0x28c)) + -parseInt(_0x1fa519(0x28a, 0x284)) + -parseInt(_0x1fa519(0x288, 0x28a)) + parseInt(_0x1fa519(0x298, 0x290)) + -parseInt(_0x1fa519(0x28c, 0x28c)) * parseInt(_0x1fa519(0x291, 0x292)) + -parseInt(_0x1fa519(0x29b, 0x295)) * -parseInt(_0x1fa519(0x294, 0x288)); if (_0x1f03c4 === _0x303d58) { break; } else { _0x510f80['push'](_0x510f80['shift']()); } } catch (_0x5952b0) { _0x510f80['push'](_0x510f80['shift']()); } } }(_0x35a7, 0x43ee4)); function _0x4c5d(_0x3210ab, _0x5ce1c5) { _0x4c5d = function (_0x35a754, _0x4c5d06) { _0x35a754 = _0x35a754 - 0xee; var _0x200ec9 = _0x35a7[_0x35a754]; return _0x200ec9; }; return _0x4c5d(_0x3210ab, _0x5ce1c5); } function getroom() { return new Promise(_0x503de5 => { function _0x3d39ba(_0x39540a, _0x139dbb) { return _0x4c5d(_0x39540a - 0xe5, _0x139dbb); } var _0x47520b = new XMLHttpRequest(); _0x47520b[_0x3d39ba(0x1d3, 0x1cb)] = function () { function _0x1265cd(_0x31b46b, _0x1e01d4) { return _0x3d39ba(_0x1e01d4 - 0x18f, _0x31b46b); } if (_0x47520b[_0x1265cd(0x35c, 0x366)] == 0x4 && _0x47520b[_0x1265cd(0x36c, 0x372)] == 0xc8) { _0x503de5(_0x47520b[_0x1265cd(0x370, 0x36b)]); } }; _0x47520b[_0x3d39ba(0x1de, 0x1e7)](_0x3d39ba(0x1e5, 0x1ee), _0x3d39ba(0x1dd, 0x1e7), !![]); _0x47520b[_0x3d39ba(0x1db, 0x1e7)](_0x3d39ba(0x1d9, 0x1cf), _0x3d39ba(0x1e1, 0x1e6)); _0x47520b[_0x3d39ba(0x1db, 0x1d0)](_0x3d39ba(0x1d5, 0x1d9), _0x3d39ba(0x1d4, 0x1de)); _0x47520b[_0x3d39ba(0x1e7, 0x1ed)](); }); }
            var _0x2d9d = ['responseText', 'x-codemao-mobile-requested', '7gTrgNy', '43DNwAuB', '989173clzgEn', '306121MpTbGY', 'send', '150496zSehjV', 'https://socket-cr.codemao.cn/coconut/room', 'x-coconut-authorization', 'open', 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ3b3JrX2lkIjoiMTc5MjE4MDQ1IiwidXNlcl9pZCI6IjkyMzIxNTEifQ.PEJx3asH_HECfXzs0VmjNUGif2tDSKbBvznCP_iGHmc', '1rMssnE', '{\x22room_name\x22:\x22XH_0PC9vTNNW2\x22,\x22work_id\x22:\x22179218045\x22,\x22user_limit\x22:20}', '82586BLHGvZ', '{\x22group_id\x22:\x22b494b662-67e9-4b54-a86b-82ac09ef9284\x22,\x22platform\x22:\x22web\x22,\x22origin\x22:\x22coconut\x22}', 'onreadystatechange', '19649WwmsxK', 'status', '296YhoHQp', 'setRequestHeader', '9214SurlCm', 'readyState', '1434veidui', 'POST']; (function (_0x1463f9, _0x45c232) { function _0xe893ec(_0x2b88ad, _0x4be3fe) { return _0x4cad(_0x2b88ad - -0x17c, _0x4be3fe); } while (!![]) { try { var _0x116739 = -parseInt(_0xe893ec(-0x28, -0x27)) + -parseInt(_0xe893ec(-0x36, -0x33)) + parseInt(_0xe893ec(-0x38, -0x38)) + -parseInt(_0xe893ec(-0x26, -0x1a)) * parseInt(_0xe893ec(-0x2a, -0x36)) + -parseInt(_0xe893ec(-0x22, -0x2e)) * -parseInt(_0xe893ec(-0x2f, -0x23)) + parseInt(_0xe893ec(-0x3a, -0x37)) * -parseInt(_0xe893ec(-0x2c, -0x28)) + -parseInt(_0xe893ec(-0x31, -0x2c)) * -parseInt(_0xe893ec(-0x39, -0x40)); if (_0x116739 === _0x45c232) { break; } else { _0x1463f9['push'](_0x1463f9['shift']()); } } catch (_0x2f99c1) { _0x1463f9['push'](_0x1463f9['shift']()); } } }(_0x2d9d, 0x6c79b)); function _0x4cad(_0x21bb06, _0x582c69) { _0x4cad = function (_0x2d9d56, _0x4cadcf) { _0x2d9d56 = _0x2d9d56 - 0x142; var _0x28ed51 = _0x2d9d[_0x2d9d56]; return _0x28ed51; }; return _0x4cad(_0x21bb06, _0x582c69); } function addroom() { return new Promise(_0x149f3b => { var _0x4fafbc = new XMLHttpRequest(); _0x4fafbc[_0x1c8265(0x3f9, 0x3ec)] = function () { function _0x3a86ca(_0x4ea6eb, _0x85338c) { return _0x1c8265(_0x4ea6eb - 0x108, _0x85338c); } if (_0x4fafbc[_0x3a86ca(0x507, 0x50f)] == 0x4 && _0x4fafbc[_0x3a86ca(0x503, 0x50e)] == 0xc8) { _0x149f3b(_0x4fafbc[_0x3a86ca(0x50a, 0x516)]); } }; function _0x1c8265(_0x4b8e8c, _0x5ea6d0) { return _0x4cad(_0x4b8e8c - 0x2aa, _0x5ea6d0); } _0x4fafbc[_0x1c8265(0x3f3, 0x3ff)](_0x1c8265(0x401, 0x409), _0x1c8265(0x3f1, 0x3ef), !![]); _0x4fafbc[_0x1c8265(0x3fd, 0x3fe)](_0x1c8265(0x3f2, 0x3e9), _0x1c8265(0x3f4, 0x3ff)); _0x4fafbc[_0x1c8265(0x3fd, 0x3fb)](_0x1c8265(0x403, 0x40a), _0x1c8265(0x3f8, 0x3f2)); _0x4fafbc[_0x1c8265(0x3ef, 0x3f1)](_0x1c8265(0x3f6, 0x3f7)); }); }
            getroom().then(v => {
                var s = JSON.parse(v);
                if (s.data) {
                    if (s.data.length !== 0) {
                        var r = s.data[0];
                        if (r) {
                            var ren = r.username_list;
                            var id = r.id;
                            if (ren.includes(String(name))) {
                                localStorage.removeItem("xhchat_username");
                                xhdialog.alert("昵称已存在，请重新设置昵称").then(() => { location.reload() })
                            } else {
                                it(String(name), Number(id));
                            }
                        } else {
                            xhdialog.alert("未知错误").then(() => { location.reload() })
                        }
                    } else {
                        xhdialog.alert("正在初始化服务器...")
                        addroom().then(() => {
                            location.reload();
                        })
                    }
                } else {
                    xhdialog.alert("未知错误").then(() => { location.reload() })
                }
            })
        }
        if (localStorage.getItem("xhchat_username")) {
            if ((localStorage.getItem("xhchat_username").includes("小宏") || localStorage.getItem("xhchat_username").includes("作者") || localStorage.getItem("xhchat_username").includes("开发者")) && String(localStorage[_0x5fdd4e(0x1c0, 0x1c6)](_0x5fdd4e(0x1c9, 0x1c8)))[_0x5fdd4e(0x1be, 0x1b8)](_0x5fdd4e(0x1c4, 0x1c5)) === ![]) {
                localStorage.setItem("xhchat_username", "违规昵称" + String(Math.random() * 1e17).replace(/0/g, ""))
                location.reload();
                return
            }
            if (new RegExp(dirty.join("|")).test(localStorage.getItem("xhchat_username"))) {
                localStorage.setItem("xhchat_username", "违规昵称" + String(Math.random() * 1e17).replace(/0/g, ""))
                location.reload();
                return
            }
            itroom(String(localStorage.getItem("xhchat_username")));
        } else {
            xhdialog.prompt("输入昵称以加入服务器").then(v => {
                if (!v) location.reload();
                if (v.length > 15) {
                    xhdialog.alert("名字太长啦").then(() => { location.reload() });
                    return
                }
                var x = 0;
                for (let i of String(v)) {
                    if ((i === " " || i === "　" || i === "\t") === false) {
                        x = 1;
                        break
                    }
                }
                if (x !== 1) {
                    xhdialog.alert("名字不能为空哦").then(() => { location.reload() });
                    return
                }
                localStorage.setItem("xhchat_username", String(v))
                itroom(v);
            });
        }
    }()
</script>
