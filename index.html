<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="shortcut icon" href="https://xiaohong2022.github.io/static/img/avatar.png">
<title>小宏の聊天室</title>
<style>
    div#app {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #bbb;
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: center;
        flex-wrap: nowrap;
        align-content: center;
    }

    .app-content {
        background: #fff;
        border-radius: 20px;
        min-width: 80%;
        max-width: 80%;
        max-height: 70%;
        min-height: 70%;
        box-shadow: 0px 10px 30px 0px #888;
        width: 80%;
        height: 70%;
    }

    .app-content-title {
        padding: 20px;
        text-align: center;
        background: #47c2ff;
        border-radius: 20px 20px 0px 0px;
        font-size: 20px;
        color: #fff;
        user-select: none;
    }

    .app-content-body {
        display: flex;
        flex-direction: row;
        width: 100%;
        height: calc(100% - 66px - 51px);
    }

    .app-content-body-left {
        width: 100px;
        height: 100%;
        border-right: solid 1px #bbb;
    }

    .app-content-body-right {
        width: calc(100% - 100px);
        height: 100%;
        overflow: auto;
    }

    .app-content-input {
        padding: 10px 15px;
        border-top: solid 1px #bbb;
        display: flex;
        flex-direction: row;
        align-items: center;
    }

    input {
        border: none;
        padding: 2px 3px;
        outline: none;
        width: calc(100% - 65px);
    }

    input:disabled {
        background-color: #fff;
        cursor: no-drop;
    }

    .app-content-body-left {
        display: flex;
        flex-direction: column;
        text-align: center;
    }

    .app-content-body-left-div {
        text-align: center;
        padding: 10px 0px;
        white-space: nowrap;
        text-overflow: ellipsis;
        width: 100%;
        overflow: hidden;
    }

    button {
        border: none;
        background: #0af;
        font-size: 15px;
        color: #fff;
        padding: 5px 10px;
        cursor: pointer;
        border-radius: 10px;
        transition: .3s;
    }

    button:hover {
        background: #009ae7;
    }

    button:active {
        transform: scale(.9);
    }

    button:disabled {
        opacity: .5;
        cursor: no-drop;
    }

    button:disabled:hover {
        background: #0af;
    }

    button:disabled:active {
        transform: scale(1);
    }

    .app-content-body-right-div {
        margin-left: 10px;
        margin-top: 5px;
        margin-bottom: 5px;
    }

    .app-content-body-right-div .app-content-body-right-div-bottom::selection {
        background: #38a3ff;
        color: #fff
    }

    .app-content-body-right-div-top {
        font-size: 14px;
        color: #888;
        margin-left: 2px;
        user-select: none;
    }

    .app-content-body-right-div-bottom {
        font-size: 16px;
        width: fit-content;
        background: #eee;
        padding: 5px 10px;
        border-radius: 5px;
    }

    .app-content-body-right-div.right {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        margin-right: 15px;
    }

    .app-content-body-right-div.right .app-content-body-right-div-bottom::selection {
        background: #fff;
        color: #38a3ff
    }

    .app-content-body-right-div.right .app-content-body-right-div-bottom {
        background: #38a3ff;
        color: #fff;
    }

    .app-content-body-right-xt {
        width: 100%;
        text-align: center;
        font-size: 15px;
        color: #aaa;
        margin-top: 10px;
        margin-bottom: 10px;
    }

    .app-content-body-right-xt::selection {
        background: #aaa;
        color: #fff
    }

    .copyright {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        height: fit-content;
        display: flex;
        justify-content: center;
        padding: 20px 0px;
        color: #555;
        user-select: none;
    }

    .app-content-body-left-top {
        display: flex;
        flex-direction: column;
        text-align: center;
        width: calc(100% - 8px * 2);
        height: calc(100% - 74px);
        overflow-y: scroll;
        padding: 0px 8px;
    }

    .app-content-body-left-top::-webkit-scrollbar {
        display: none;
    }

    .app-content-body-left-bottom {
        display: flex;
        flex-direction: column;
        width: 100%;
        height: fit-content;
    }

    .app-content-body-left-bottom-setname {
        text-align: center;
        padding: 10px 0px;
        border-top: solid 1px #bbb;
        font-size: 12px;
        cursor: pointer;
        user-select: none;
    }

    .app-content-body-left-bottom-clearmsg {
        text-align: center;
        padding: 10px 0px;
        border-top: solid 1px #bbb;
        font-size: 12px;
        cursor: pointer;
        user-select: none;
    }

    @media (max-width: 700px) {
        .app-content {
            background: #fff;
            border-radius: 0px;
            min-width: 100%;
            max-width: 100%;
            max-height: 100%;
            min-height: 100%;
            box-shadow: none;
            width: 100%;
            height: 100%;
        }

        .app-content-title {
            border-radius: 0px;
        }

        .copyright {
            bottom: 50px;
            font-size: 12px;
        }
    }
</style>
<div id="app">
    <div class="app-content">
        <div class="app-content-title">小宏の聊天室（<r>0</r> / 20）</div>
        <div class="app-content-body">
            <div class="app-content-body-left">
                <div class="app-content-body-left-top"></div>
                <div class="app-content-body-left-bottom">
                    <div class="app-content-body-left-bottom-setname">更改名字</div>
                    <div class="app-content-body-left-bottom-clearmsg">清空聊天记录</div>
                </div>
            </div>
            <div class="app-content-body-right"></div>
        </div>
        <div class="app-content-input">
            <input placeholder="说点啥好呢？">
            <button>发送！</button>
        </div>
    </div>
    <div class="copyright">Copyright (c) 2023 xiaohong2022</div>
</div>
<script>
    !function () {
        var $jscomp = $jscomp || {}; $jscomp.scope = {}; $jscomp.createTemplateTagFirstArg = function (b) { return b.raw = b }; $jscomp.createTemplateTagFirstArgWithRaw = function (b, c) { b.raw = c; return b }; $jscomp.arrayIteratorImpl = function (b) { var c = 0; return function () { return c < b.length ? { done: !1, value: b[c++] } : { done: !0 } } }; $jscomp.arrayIterator = function (b) { return { next: $jscomp.arrayIteratorImpl(b) } }; $jscomp.makeIterator = function (b) { var c = "undefined" != typeof Symbol && Symbol.iterator && b[Symbol.iterator]; return c ? c.call(b) : $jscomp.arrayIterator(b) };
        !function (b, c) { "object" == typeof exports && "undefined" != typeof module ? module.exports = c() : "function" == typeof define && define.amd ? define(c) : (b = "undefined" != typeof globalThis ? globalThis : b || self).xhdialog = c() }(this, function () {
            var b = function (a, e) {
                var d = this, f = document.createElement("button"); f.className = "xhdialog-options-btn" + (a.class ? " " + ("string" == typeof a.class ? a.class : "object" == typeof a.class ? Object.values(a.class).join(" ") : "") : ""); f.addEventListener("click", a.onClick ? a.onClick : null); f.addEventListener("click",
                    function () { d.options.closeOnClick && d.$offsetDialog._root.close(d._selectValue) }); f.innerHTML = '<div class="xhdialog-options-btn-loading xhdialog-options-btn-loading-close"></div><span></span>'; this.$element = f; this.$offsetDialog = e; this.$element.querySelector("span").innerText = a.text; this._state = "enable"; this._loading = !1; this.options = { closeOnClick: !!a.closeOnClick }; this._selectValue = a.value
            }; b.prototype.startload = function () {
                this.$element.querySelector(".xhdialog-options-btn-loading").classList.remove("xhdialog-options-btn-loading-close");
                this._loading = !0; return this
            }; b.prototype.stopload = function () { this.$element.querySelector(".xhdialog-options-btn-loading").classList.add("xhdialog-options-btn-loading-close"); this._loading = !1; return this }; b.prototype.remove = function () { this.$element.remove() }; b.prototype.setText = function (a) { this.$element.querySelector("span").innerText = a; return this }; b.prototype.getText = function () { return this.$element.querySelector("span").innerHTML }; b.prototype.disabled = function (a) {
                this._state = (this.$element.disabled =
                    void 0 === a ? !0 : a) ? "disabled" : "enable"; return this
            }; b.prototype.enable = function (a) { a = void 0 === a ? !0 : a; this.$element.disabled = !a; this._state = a ? "enable" : "disabled"; return this }; var c = function (a) {
                var e = this, d = document.createElement("div"); d.className = "xhdialog" + (a.class ? " " + ("string" == typeof a.class ? a.class : "object" == typeof a.class ? Object.values(a.class).join(" ") : "") : ""); this.$element = d; var f = document.createElement("div"); f.className = "xhdialog-overlay"; this.$overlay = f; var g = a.title ? '<div class="xhdialog-title">' +
                    a.title + "</div>" : ""; g += '<div class="xhdialog-content">' + (a.content ? a.content : "") + "</div>"; d.innerHTML = g; if (a.buttons) { g = document.createElement("div"); g.className = "xhdialog-options"; for (var l = a.buttons.map(function (n) { return new b(n, d) }), m = $jscomp.makeIterator(l), h = m.next(); !h.done; h = m.next())h = h.value, g.appendChild(h.$element), h.$element._root = h; d.appendChild(g); this.buttons = { $card: g, $elements: l } } this._state = "close"; f.addEventListener("click", function () { e.options.overlayOnClose && e.close(e._overlayValue) });
                document.body.appendChild(d); this._select = null; this._overlayValue = a.overlayValue; d._root = this; this.options = { removeOnClose: !!a.removeOnClose, overlayOnClose: a.overlayOnClose || !0 }
            }; c.prototype.open = function () {
                var a = this; document.body.appendChild(this.$overlay); this.$element.classList.add("xhdialog-animation-open"); this.$overlay.classList.add("xhdialog-overlay-animation-open"); document.body.classList.add("xhdialog-body-lock"); setTimeout(function () {
                    a.$element.classList.add("xhdialog-open"); a.$overlay.classList.add("xhdialog-overlay-show");
                    a.$element.classList.remove("xhdialog-animation-open"); a.$overlay.classList.remove("xhdialog-overlay-animation-open")
                }, 10); this._state = "open"; return this
            }; c.prototype.close = function (a) {
                var e = this; this.$element.classList.add("xhdialog-animation-close"); this.$overlay.classList.add("xhdialog-overlay-animation-close"); 1 == document.querySelectorAll(".xhdialog").length && document.body.classList.remove("xhdialog-body-lock"); setTimeout(function () {
                    e.$element.classList.remove("xhdialog-open"); e.$overlay.classList.remove("xhdialog-overlay-show");
                    e.$element.classList.remove("xhdialog-animation-close"); e.$overlay.classList.remove("xhdialog-overlay-animation-close"); e.options.removeOnClose ? e.remove() : document.body.removeChild(e.$overlay)
                }, 300); this._select = a; this._state = "close"; return a
            }; c.prototype.remove = function () { this.$element.remove(); this.$overlay.remove() }; c.prototype.isOpen = function () { return "open" == this._state }; c.prototype.addElement = function (a) { this.$element.querySelector(".xhdialog-content").appendChild(a); return a }; var k = document.createElement("style");
            k.type = "text/css"; k.innerHTML = `.xhdialog{box-sizing:border-box;margin:0;padding:0;outline:0}body.xhdialog-body-lock{overflow:hidden}.xhdialog-overlay{position:fixed;top:0;left:0;z-index:50000;display:none;box-sizing:border-box;background:rgba(0,0,0,.4);opacity:0;-webkit-transition:.3s,width 0s,height 0s;transition:.3s,width 0s,height 0s}.xhdialog-overlay-show{display:block;width:100%;height:100%;opacity:1}.xhdialog-overlay-animation-open{display:block;opacity:0}.xhdialog-overlay-animation-close{opacity:0}
.xhdialog{position:fixed;top:0;right:0;bottom:0;left:0;z-index:999999999;display:none;overflow:hidden;margin:auto;padding:20px 30px 70px;max-width:70%;max-height:70%;min-width:300px;min-height:170px;-webkit-border-radius:10px;border-radius:10px;background:#fff;-webkit-box-shadow:0 11px 15px -7px rgb(0 0 0/20%),0 24px 38px 3px rgb(0 0 0/14%),0 9px 46px 8px rgb(0 0 0/12%);box-shadow:0 11px 15px -7px rgb(0 0 0/20%),0 24px 38px 3px rgb(0 0 0/14%),0 9px 46px 8px rgb(0 0 0/12%);-webkit-transition-duration:.3s;transition-duration:.3s;
-webkit-transform:scale(.7);transform:scale(.7)}.xhdialog.xhdialog-open{display:block;-webkit-transform:scale(1);transform:scale(1)}.xhdialog.xhdialog-animation-open{display:block;opacity:0}.xhdialog.xhdialog-animation-close{opacity:0;-webkit-transform:scale(.7);transform:scale(.7)}.xhdialog button.xhdialog-options-btn{margin-left:9px;padding:6px 13px;border:1px solid #aaa;border-radius:5px;background:0 0;color:#000;font-size:14px;cursor:pointer;-webkit-transition-duration:.3s;transition-duration:.3s;user-select:none!important;
-webkit-user-select:none!important;-moz-user-select:none!important;-ms-user-select:none!important}.xhdialog button.xhdialog-options-btn:hover{background:rgba(0,0,0,.07)}.xhdialog button.xhdialog-options-btn:active{background:rgba(0,0,0,.2);-webkit-transform:scale(.9);transform:scale(.9)}.xhdialog button.xhdialog-options-btn.xhdialog-options-btn-confirm{border:1px solid var(--color-primary);background:var(--color-primary);color:var(--color-button-text)}.xhdialog button.xhdialog-options-btn.xhdialog-options-btn-confirm:hover{
border:1px solid var(--color-primary-hover);background:var(--color-primary-hover)}.xhdialog button.xhdialog-options-btn.xhdialog-options-btn-confirm:active{border:1px solid var(--color-primary-press);background:var(--color-primary-press)}.xhdialog button.xhdialog-options-btn[disabled]{opacity:.4;cursor:auto;-webkit-transform:scale(1);transform:scale(1)}.xhdialog .xhdialog-options{position:fixed;right:30px;bottom:20px}.xhdialog .xhdialog-title{margin-bottom:10px;color:var(--title-color);font-size:27px;user-select:none;
-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none}.xhdialog .xhdialog-content{color:var(--content-color);white-space:pre-wrap;word-wrap:break-word;font-size:14px}.xhdialog-prompt-input{margin-top:5px;padding:5px 10px;width:100%;outline:0;border:1px solid #aaa;border-radius:5px;background:0 0;color:#000;font-size:14px;-webkit-transition-duration:.3s;transition-duration:.3s}.xhdialog-prompt-input:focus-visible{border:1px solid #0af}.xhdialog .xhdialog-content{display:flex;flex-direction:column;align-items:flex-start}
.xhdialog-alert,.xhdialog-confirm,.xhdialog-prompt{max-width:40%;max-height:30%}.xhdialog{--color-primary:#0af;--color-primary-hover:rgba(0,170,255,0.87);--color-primary-press:rgba(0,170,255,0.6);--color-button-text:#fff;--title-color:#000;--content-color:rgba(0,0,0,0.73)}`
            document.head.appendChild(k); return {
                alert: async function (a) { a = new c({ title: "系统", content: a, buttons: [{ text: "确认", value: void 0, closeOnClick: !0, class: "xhdialog-options-btn-confirm" }], class: ["xhdialog-alert"], removeOnClose: !0, overlayValue: void 0 }); await new Promise(requestAnimationFrame); a.open(); for (await new Promise(requestAnimationFrame); ;) { if (!a.isOpen()) { await new Promise(requestAnimationFrame); break } await new Promise(requestAnimationFrame) } }, confirm: async function (a) {
                    a = new c({
                        title: "系统", content: a, buttons: [{
                            text: "确认", value: !0,
                            closeOnClick: !0, class: "xhdialog-options-btn-confirm"
                        }, { text: "取消", value: !1, closeOnClick: !0 }], class: ["xhdialog-confirm"], removeOnClose: !0, overlayValue: !1
                    }); await new Promise(requestAnimationFrame); a.open(); for (await new Promise(requestAnimationFrame); ;) { if (!a.isOpen()) return await new Promise(requestAnimationFrame), a._select; await new Promise(requestAnimationFrame) }
                }, prompt: async function (a, e) {
                    a = new c({
                        title: "系统", content: a, buttons: [{ text: "确认", value: !0, closeOnClick: !0, class: "xhdialog-options-btn-confirm" }, {
                            text: "取消",
                            value: !1, closeOnClick: !0
                        }], class: ["xhdialog-prompt"], removeOnClose: !0, overlayValue: !1
                    }); var d = document.createElement("input"); d.className = "xhdialog-prompt-input"; d.value = e || ""; a.$element.querySelector(".xhdialog-content").appendChild(d); await new Promise(requestAnimationFrame); a.open(); for (await new Promise(requestAnimationFrame); ;) { if (!a.isOpen()) return await new Promise(requestAnimationFrame), a._select ? d.value : null; await new Promise(requestAnimationFrame) }
                }, Dialog: c
            }
        });
    }();
    !function () {
        /**@return {IDBFactory}*/
        function getIndexDB() {
            const i =
                window.indexedDB ||
                window.mozIndexedDB ||
                window.webkitIndexedDB ||
                window.msIndexedDB ||
                window.shimIndexedDB;
            if (i) {
                return i
            }
            return null
        }
        var indexeddb = getIndexDB();
        var dbsql = indexeddb.open("xhchat_db", 1);
        dbsql.onupgradeneeded = () => {
            const db = dbsql.result;
            const store = db.createObjectStore("messages", {
                keyPath: "id",
                autoIncrement: true,
            });
        };
        dbsql.onsuccess = () => {
            console.log("本地消息数据库连接已建立");
        };
        function cleardbmsg() {
            const db = dbsql.result
            const tx = db.transaction("messages", "readwrite")
            const todosStore = tx.objectStore("messages")
            todosStore.clear();
        };
        var _0x5d01 = ['1299949OTNWUP', '477908rVjrps', '89tAxXeM', '0PC9vTNNW2', '1096617smWXFX', '5vLMkPR', 'includes', '12442KnPYlz', 'getItem', '11KJyVPi', '235661ycXZCU', '35671lWVole', 'sw3ABkNC5Bn4ah3onG6i', '896197jEBulW'];
        (function (_0x23b3c1, _0x28d863) {
            function _0x434218(_0x5b21f1, _0x10911f) {
                return _0x2f09(_0x10911f - 0x226, _0x5b21f1);
            }
            while (!![]) {
                try {
                    var _0x4abb34 = -parseInt(_0x434218(0x29c, 0x29c)) + parseInt(_0x434218(0x299, 0x29b)) + parseInt(_0x434218(0x29b, 0x2a0)) + parseInt(_0x434218(0x290, 0x295)) * parseInt(_0x434218(0x29b, 0x29e)) + -parseInt(_0x434218(0x29b, 0x299)) * parseInt(_0x434218(0x295, 0x297)) + parseInt(_0x434218(0x2a4, 0x29d)) + parseInt(_0x434218(0x294, 0x298)) * -parseInt(_0x434218(0x2a7, 0x2a1));
                    if (_0x4abb34 === _0x28d863) {
                        break;
                    } else {
                        _0x23b3c1['push'](_0x23b3c1['shift']());
                    }
                } catch (_0x1368be) {
                    _0x23b3c1['push'](_0x23b3c1['shift']());
                }
            }
        }(_0x5d01, 0xacb61));
        function _0x5fdd4e(_0x5e6980, _0x2e8cdd) {
            return _0x2f09(_0x5e6980 - 0x150, _0x2e8cdd);
        }
        function _0x2f09(_0x1468b7, _0x53f62a) {
            _0x2f09 = function (_0x5d01f9, _0x2f09de) {
                _0x5d01f9 = _0x5d01f9 - 0x6e;
                var _0x14a610 = _0x5d01[_0x5d01f9];
                return _0x14a610;
            }
                ;
            return _0x2f09(_0x1468b7, _0x53f62a);
        }
        function it(name) {
            if (!name) location.reload();
            var renlist = [];
            var room_id = 37677;
            var wwwwww = 0;
            var sleeplenmgth = 0;
            if (!localStorage.getItem("xhchat_isreadannouncement")) {
                localStorage.setItem("xhchat_isreadannouncement", "1")
                xhdialog.alert("近期更新：v1.1.0\n1. 添加聊天记录储存\n2. 名字可以储存到本地了，点击左边的“更改名字”即可更改名字\n3. 添加屏蔽词\n4. 聊天字数上限30字，名字上限15字\n5. 不能发空消息，不能设置空名字")
            }
            function updataman() {
                document.querySelector("r").innerText = renlist.length;
                document.querySelector(".app-content-body-left-top").innerHTML = renlist.map(v => `<div class="app-content-body-left-div" title="${v}">${v}</div>`).join("")
            }
            function sleepsend() {
                document.querySelector("input").disabled = true;
                document.querySelector("button").disabled = true;
                var x = Number(sleeplenmgth);
                document.querySelector("input").placeholder = `请 静息 ${x}秒 后再来吧~`
                var y = setInterval(() => {
                    x--;
                    document.querySelector("input").placeholder = `请 静息 ${x}秒 后再来吧~`
                    if (x === 0) {
                        clearInterval(y)
                        document.querySelector("input").disabled = false;
                        document.querySelector("button").disabled = false;
                        document.querySelector("input").placeholder = `静息结束！可以继续发消息~`
                        setTimeout(() => {
                            document.querySelector("input").placeholder = `说点啥好呢？`
                        }, 1000)
                    }
                }, 1000);
            }
            function ask() {
                console.log("重名检查开始")
                var t = [];
                for (let i of renlist) {
                    console.log("检查名字", i);
                    if (t.includes(i) === false) {
                        t.push(i)
                        console.log("未重名");
                    }
                    else {
                        console.log("发现重名");
                        if (String(localStorage[_0x5fdd4e(0x1c0, 0x1c6)](_0x5fdd4e(0x1c9, 0x1c8)))[_0x5fdd4e(0x1be, 0x1b8)](_0x5fdd4e(0x1c4, 0x1c5)) === ![]) {
                            document.querySelector("#app").style.display = "none";
                            xhdialog.alert("昵称已存在，请重新命名").then(() => { location.reload() })
                        }
                        break;
                    }
                }
                console.log("重名检查结束")
            }
            function dbToMessage() {
                const db = dbsql.result
                const tx = db.transaction("messages", "readwrite")
                const todosStore = tx.objectStore("messages")
                const query = todosStore.getAll()
                query.onsuccess = () => {
                    console.log("消息数据库", query.result);
                    query.result.map(v => JSON.parse(v.text)).forEach(v => {
                        if (v.type === 0) {
                            addSystemMsg(v.data);
                        } else {
                            if (v.data.side === 1) {
                                addmsg(name, v.data.data)
                            } else {
                                addmsg(v.data.name, v.data.data)
                            }
                        }
                    })
                }
            }
            function addMessageToDB(data) {
                const db = dbsql.result
                const tx = db.transaction("messages", "readwrite")
                const todosStore = tx.objectStore("messages")
                const text = JSON.stringify(data)
                todosStore.put({ text });
            }
            function addmsg(n, s) {
                var r = document.createElement("div");
                r.className = "app-content-body-right-div"
                var r1 = document.createElement("div");
                r1.className = "app-content-body-right-div-top"
                var r2 = document.createElement("div");
                r2.className = "app-content-body-right-div-bottom"
                r1.innerText = n;
                r2.innerText = s;
                r.append(r1, r2);
                r.className += ` ${n === name ? "right" : "left"}`
                document.querySelector(".app-content-body-right").appendChild(r);
                var ws = document.querySelector(".app-content-body-right")
                ws.scrollTop = ws.scrollHeight;
            }
            function addSystemMsg(s) {
                var r = document.createElement("div");
                r.className = "app-content-body-right-xt"
                r.innerText = s;
                document.querySelector(".app-content-body-right").appendChild(r);
                var ws = document.querySelector(".app-content-body-right")
                ws.scrollTop = ws.scrollHeight;
            };
            var webs = new WebSocket("wss://socket-cr.codemao.cn:9090/coconut/?x-coconut-authorization=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ3b3JrX2lkIjoiMTc5MjE4MDQ1IiwidXNlcl9pZCI6IjkyMzIxNTEifQ.PEJx3asH_HECfXzs0VmjNUGif2tDSKbBvznCP_iGHmc&X-CodeMao-Mobile-Requested=%7B%22group_id%22%3A%22b494b662-67e9-4b54-a86b-82ac09ef9284%22%2C%22platform%22%3A%22web%22%2C%22origin%22%3A%22coconut%22%7D&EIO=3&transport=websocket");
            webs.onclose = function () {
                console.log("服务器中断！")
                document.querySelector("#app").style.display = "none";
                xhdialog.alert("服务器中断！即将重新加载！").then(() => { location.reload() })
            };
            function sendMessage(e) {
                if (e.length > 30) {
                    addSystemMsg("消息太长啦")
                    return
                }
                var x = 0;
                for (let i of String(e)) {
                    if ((i === " " || i === "　" || i === "\t") === false) {
                        x = 1;
                        break
                    }
                }
                if (x !== 1) {
                    addSystemMsg("消息不能为空哦")
                    return
                };
                wwwwww++;
                if (wwwwww > 5) {
                    wwwwww = 0;
                    sleeplenmgth += 5;
                    sleepsend();
                }
                var dirty = [
                    "舔吮",
                    "抗议",
                    "打死",
                    "变态",
                    "麻痹",
                    "接吻",
                    "流血",
                    "侮辱",
                    "去死",
                    "舔着",
                    "按摩",
                    "狗叫",
                    "裤衩",
                    "孬种",
                    "刺激",
                    "青天白日",
                    "拔出来",
                    "呻吟",
                    "小便",
                    "牛比",
                    "无耻",
                    "想死",
                    "出血",
                    "裸露",
                    "找死",
                    "猎枪",
                    "狂吠",
                    "双筒",
                    "发愣",
                    "死刑",
                    "和狗",
                    "老母猪",
                    "小姐",
                    "舔吻",
                    "快感",
                    "爱抚",
                    "情侣",
                    "能儿",
                    "卿卿我我",
                    "插进",
                    "浑圆",
                    "的逼",
                    "娇喘",
                    "教徒",
                    "单身",
                    "约会",
                    "玛叼",
                    "祖宗",
                    "兴奋剂",
                    "淫威",
                    "交配",
                    "发情",
                    "窝囊废",
                    "掉你",
                    "勾搭",
                    "西藏",
                    "主权",
                    "抓胸",
                    "啦沙",
                    "娘的",
                    "抚摸",
                    "天葬",
                    "夫君",
                    "夫妻",
                    "羞辱",
                    "厚脸皮",
                    "谩骂",
                    "傻瓜",
                    "兽性",
                    "示威",
                    "表白",
                    "舔动着",
                    "畜生",
                    "铅弹",
                    "恋爱",
                    "射死",
                    "调教",
                    "是狗",
                    "凌辱",
                    "轮手",
                    "满狗",
                    "去世",
                    "毒蛇钻",
                    "全家",
                    "穴里",
                    "巴嘎",
                    "不穿",
                    "弓弩",
                    "兼职",
                    "上他",
                    "对象",
                    "毒枭",
                    "麻醉枪",
                    "污的",
                    "经文",
                    "法轮",
                    "啵啵",
                    "外孙",
                    "藏民",
                    "卑鄙",
                    "护法",
                    "纠纷",
                    "汉人",
                    "国民党",
                    "死你",
                    "亲一口",
                    "升天",
                    "有病",
                    "放屁",
                    "尼玛",
                    "疯狗",
                    "密宗",
                    "枪手",
                    "自杀",
                    "铃声",
                    "砍死",
                    "白嫩",
                    "骚",
                    "妈的",
                    "md",
                    "MD",
                    "SB",
                    "sb",
                    "Sb",
                    "sB",
                    "傻逼",
                    "傻子",
                    "傻蛋",
                    "脑残",
                    "卧槽",
                    "我操",
                    "我草",
                    "牛逼",
                    "wc",
                    "mD",
                    "Md",
                    "猛吸",
                    "哥哥",
                    "强暴",
                    "脱光",
                    "人渣",
                    "日你",
                    "法会",
                    "儿子",
                    "性爱",
                    "走狗",
                    "牛粪",
                    "粪便",
                    "屎",
                    "枪毙",
                    "绑架",
                    "活和",
                    "杂种",
                    "了他",
                    "奶滴",
                    "笨蛋",
                    "法正",
                    "受孕",
                    "情人",
                    "鄙视",
                    "流氓",
                    "白痴",
                    "丑八怪",
                    "滚开",
                    "弱智",
                    "孤儿",
                    "无期徒刑",
                    "他妈",
                    "TM",
                    "tm",
                    "Tm",
                    "tM",
                    "踏马",
                    "™",
                    "欲火",
                    "红色恐怖",
                    "干死",
                    "腐败",
                    "打针",
                    "马叼",
                    "色色",
                    "成人社",
                    "同居",
                    "禽兽",
                    "幼女"
                ]
                if (new RegExp(dirty.join("|")).test(String(e))) {
                    addSystemMsg(">:(")
                }
                webs.send(`42["broadcast",${JSON.stringify({
                    data: String(e).replace(new RegExp(dirty.join("|"), "g"), function (v) { iss = 1; return "*".repeat(v.length) }),
                    room_id: room_id,
                    username: name
                })}]`);
            }
            function joinMan(r) {
                webs.send(`42["join",${JSON.stringify({
                    room_name: "XH_zu8s1tQ0g1",
                    username: r,
                    room_id: room_id,
                    work_id: "179218045"
                })}]`)
            }
            function leave(r) {
                webs.send(`42["leave",${JSON.stringify({
                    room_name: "XH_zu8s1tQ0g1",
                    username: r,
                    room_id: room_id,
                    work_id: "179218045"
                })}]`)
            }
            function ping() {
                webs.send("2");
            }
            function init() {
                dbToMessage();
                document.querySelector(".app-content-input input").addEventListener("keypress", function (v) {
                    if (v.keyCode === 13 && this.value !== "") {
                        sendMessage(this.value);
                        this.value = "";
                    }
                });
                document.querySelector(".app-content-input button").addEventListener("click", function (v) {
                    if (document.querySelector(".app-content-input input").value !== "") {
                        sendMessage(document.querySelector(".app-content-input input").value);
                        document.querySelector(".app-content-input input").value = "";
                    } else {
                        xhdialog.alert("欸，这框里...啥也没有欸")
                    }
                });
                document.querySelector(".app-content-body-left-bottom-clearmsg").addEventListener("click", function () {
                    xhdialog.confirm("你真的要清空聊天记录吗？").then(v => {
                        if (v) {
                            cleardbmsg();
                            document.querySelector(".app-content-body-right").innerHTML = "";
                        }
                    })
                });
                document.querySelector(".app-content-body-left-bottom-setname").addEventListener("click", function () {
                    xhdialog.prompt("输入新名字（需要重进）").then(v => {
                        if (v.length > 15) {
                            xhdialog.alert("名字太长啦")
                            return
                        }
                        var x = 0;
                        for (let i of String(v)) {
                            if ((i === " " || i === "　" || i === "\t") === false) {
                                x = 1;
                                break
                            }
                        }
                        if (x !== 1) {
                            xhdialog.alert("名字不能为空哦")
                            return
                        }
                        localStorage.setItem("xhchat_username", String(v))
                        location.reload()
                    });
                });
                window.addEventListener("beforeunload", function () {
                    leave(name)
                })
            }
            function onmsg({ data }) {
                var d = data
                if (d.startsWith("0")) {
                    console.log(JSON.parse(d.slice(1)))
                    joinMan(name);
                    init();
                } else if (isNaN(Number(d)) === false) {
                    if (d === "3") {
                        console.log("服务器ping成功")
                    } else if (d === "1") {
                        console.log("服务器即将中断")
                    } else if (d === "40") {
                        console.log("服务器加入成功")
                    }
                } else if (d.startsWith("42")) {
                    var w = JSON.parse(d.slice(2));
                    console.log(w);
                    var d2 = w[1]
                    switch (w[0]) {
                        case "join":
                            addSystemMsg(`${d2.username} 进入了聊天室`)
                            addMessageToDB({
                                type: 0,
                                data: `${d2.username} 进入了聊天室`
                            });
                            if (d2.username != name) {
                                renlist.push(d2.username);
                            };
                            updataman()
                            break;
                        case "join_ack":
                            renlist = d2.username_list
                            updataman()
                            ask()
                            break;
                        case "leave":
                            addSystemMsg(`${d2.username} 离开了聊天室`)
                            addMessageToDB({
                                type: 0,
                                data: `${d2.username} 离开了聊天室`
                            });
                            renlist.splice(renlist.indexOf(d2.username), 1);
                            updataman()
                            break;
                        case "broadcast":
                            addmsg(d2.username, d2.data)
                            addMessageToDB({
                                type: 1,
                                data: {
                                    data: d2.data,
                                    name: d2.username,
                                    side: d2.username === name ? 1 : 0
                                }
                            });
                            break;
                        case "error":
                            document.querySelector("#app").style.display = "none";
                            xhdialog.alert(d2.message).then(() => { location.reload() })
                            break;
                    }
                }
            }
            setInterval(() => {
                ping();
            }, 50000)
            webs.onmessage = onmsg;
        };
        if (localStorage.getItem("xhchat_username")) {
            if (localStorage.getItem("xhchat_username").includes("小宏") && String(localStorage[_0x5fdd4e(0x1c0, 0x1c6)](_0x5fdd4e(0x1c9, 0x1c8)))[_0x5fdd4e(0x1be, 0x1b8)](_0x5fdd4e(0x1c4, 0x1c5)) === ![]) {
                localStorage.setItem("xhchat_username", "违规名字" + (Math.random() * 100000000000000000))
                location.reload();
                return
            }
            it(String(localStorage.getItem("xhchat_username")));
        } else {
            xhdialog.prompt("输入昵称以加入服务器").then(v => {
                if (v.length > 15) {
                    xhdialog.alert("名字太长啦").then(() => { location.reload() });
                    return
                }
                var x = 0;
                for (let i of String(v)) {
                    if ((i === " " || i === "　" || i === "\t") === false) {
                        x = 1;
                        break
                    }
                }
                if (x !== 1) {
                    xhdialog.alert("名字不能为空哦").then(() => { location.reload() });
                    return
                }
                localStorage.setItem("xhchat_username", String(v))
                it(v);
            });
        }
    }()
</script>
